PER_create_ahmad = {
	if = {
		limit = { PER = { PER_ahmad_shah_qajar = { is_dead = no } } }
		PER_set_monarchy_cosmetic_tag = yes
		PER = {
			PER_ahmad_shah_qajar = {
				character_becomes_leader_of_ruling_party_effect_tooltip = yes
				hidden_effect = {
					set_nationality = PREV.PREV
					remove_all_country_leader_roles = yes
					add_country_leader_role = {
						country_leader = {
							desc = PER_ahmad_shah_qajar_leader_desc
							ideology = social_democrat_subtype
						}
						promote_leader = yes
					}
					add_country_leader_role = {
						country_leader = {
							desc = PER_ahmad_shah_qajar_leader_desc
							ideology = social_liberal_subtype
						}
						promote_leader = yes
					}
					add_country_leader_role = {
						country_leader = {
							desc = PER_ahmad_shah_qajar_leader_desc
							ideology = market_liberal_subtype
						}
						promote_leader = yes
					}
					add_country_leader_role = {
						country_leader = {
							desc = PER_ahmad_shah_qajar_leader_desc
							ideology = social_conservative_subtype
						}
						promote_leader = yes
					}
					add_country_leader_role = {
						country_leader = {
							desc = PER_ahmad_shah_qajar_leader_desc
							ideology = authoritarian_democrat_subtype
						}
						promote_leader = yes
					}
					add_country_leader_role = {
						country_leader = {
							desc = PER_ahmad_shah_qajar_leader_desc
							ideology = paternal_autocrat_subtype
						}
						promote_leader = yes
					}
					add_country_leader_role = {
						country_leader = {
							desc = PER_ahmad_shah_qajar_leader_desc
							ideology = national_populist_subtype
						}
						promote_leader = yes
					}
				}
			}
		}
	}
	else = {
		PER_create_hassan = yes
	}
}

PER_create_hassan = {
	if = {
		limit = { PER = { PER_hassan_mirza_qajar = { is_dead = no } } }
		PER_set_monarchy_cosmetic_tag = yes
		PER = {
			PER_hassan_mirza_qajar = {
				character_becomes_leader_of_ruling_party_effect_tooltip = yes
				hidden_effect = {
					set_nationality = PREV.PREV
					remove_all_country_leader_roles = yes
					add_country_leader_role = {
						country_leader = {
							desc = PER_hassan_mirza_qajar_commander_desc
							ideology = social_democrat_subtype
						}
						promote_leader = yes
					}
					add_country_leader_role = {
						country_leader = {
							desc = PER_hassan_mirza_qajar_commander_desc
							ideology = social_liberal_subtype
						}
						promote_leader = yes
					}
					add_country_leader_role = {
						country_leader = {
							desc = PER_hassan_mirza_qajar_commander_desc
							ideology = market_liberal_subtype
						}
						promote_leader = yes
					}
					add_country_leader_role = {
						country_leader = {
							desc = PER_hassan_mirza_qajar_commander_desc
							ideology = social_conservative_subtype
						}
						promote_leader = yes
					}
					add_country_leader_role = {
						country_leader = {
							desc = PER_hassan_mirza_qajar_commander_desc
							ideology = authoritarian_democrat_subtype
						}
						promote_leader = yes
					}
					add_country_leader_role = {
						country_leader = {
							desc = PER_hassan_mirza_qajar_commander_desc
							ideology = paternal_autocrat_subtype
						}
						promote_leader = yes
					}
					add_country_leader_role = {
						country_leader = {
							desc = PER_hassan_mirza_qajar_commander_desc
							ideology = national_populist_subtype
						}
						promote_leader = yes
					}
				}
			}
		}
	}
	else = {
		PER_create_hamid = yes
	}
}

PER_create_hamid = {
	if = {
		limit = { PER = { PER_hamid_mirza_qajar = { is_dead = no } } }
		PER_set_monarchy_cosmetic_tag = yes
		PER = {
			PER_hamid_mirza_qajar = {
				character_becomes_leader_of_ruling_party_effect_tooltip = yes
				hidden_effect = {
					set_nationality = PREV.PREV
					remove_all_country_leader_roles = yes
					add_country_leader_role = {
						country_leader = {
							desc = PER_hamid_mirza_qajar_leader_desc
							ideology = social_democrat_subtype
						}
						promote_leader = yes
					}
					add_country_leader_role = {
						country_leader = {
							desc = PER_hamid_mirza_qajar_leader_desc
							ideology = social_liberal_subtype
						}
						promote_leader = yes
					}
					add_country_leader_role = {
						country_leader = {
							desc = PER_hamid_mirza_qajar_leader_desc
							ideology = market_liberal_subtype
						}
						promote_leader = yes
					}
					add_country_leader_role = {
						country_leader = {
							desc = PER_hamid_mirza_qajar_leader_desc
							ideology = social_conservative_subtype
						}
						promote_leader = yes
					}
					add_country_leader_role = {
						country_leader = {
							desc = PER_hamid_mirza_qajar_leader_desc
							ideology = authoritarian_democrat_subtype
						}
						promote_leader = yes
					}
					add_country_leader_role = {
						country_leader = {
							desc = PER_hamid_mirza_qajar_leader_desc
							ideology = paternal_autocrat_subtype
						}
						promote_leader = yes
					}
					add_country_leader_role = {
						country_leader = {
							desc = PER_hamid_mirza_qajar_leader_desc
							ideology = national_populist_subtype
						}
						promote_leader = yes
					}
				}
			}
		}
	}
}

PER_set_monarchy_cosmetic_tag = {
	if = {
		limit = { has_cosmetic_tag = PER_iran }
		set_cosmetic_tag = PER_iran_monarchy
	}
	else_if = {
		limit = { NOT = { has_cosmetic_tag = PER_monarchy } }
		set_cosmetic_tag = PER_monarchy
	}
}

PER_remove_monarchy = {
	if = {
		limit = { has_cosmetic_tag = PER_iran_monarchy }
		set_cosmetic_tag = PER_iran
	}
	else_if = {
		limit = { has_cosmetic_tag = PER_monarchy }
		drop_cosmetic_tag = yes
	}
	if = {
		limit = { has_character = PER_ahmad_shah_qajar }
		PER_ahmad_shah_qajar = {
			hidden_effect = { remove_all_country_leader_roles = yes }
			retire = yes
		}
	}
	if = {
		limit = { has_character = PER_hassan_mirza_qajar }
		PER_hassan_mirza_qajar = {
			hidden_effect = { remove_all_country_leader_roles = yes }
			retire = yes
		}
	}
	if = {
		limit = { has_character = PER_hamid_mirza_qajar }
		PER_hamid_mirza_qajar = {
			hidden_effect = { remove_all_country_leader_roles = yes }
			retire = yes
		}
	}
}

PER_forpol_setup = {
	### Setup non-socialist AI PER foreign alignment after LC is over
	if = {
		limit = {
			is_ai = yes
			has_socialist_government = no
			NOT = {
				has_country_flag = PER_align_with_GER
				has_country_flag = PER_align_with_RUS
				has_country_flag = PER_neutrality
			}
		}
		if = {
			limit = { has_game_rule = { rule = PER_forpol option = PER_FORPOL_GER } }
			set_country_flag = PER_align_with_GER
		}
		else_if = {
			limit = { has_game_rule = { rule = PER_forpol option = PER_FORPOL_RUS } }
			set_country_flag = PER_align_with_RUS
		}
		else_if = {
			limit = { has_game_rule = { rule = PER_forpol option = PER_FORPOL_NEUT } }
			set_country_flag = PER_neutrality
		}
		else = {
			random_list = {
				## Align with GER
				35 = {
					modifier = {
						factor = 0
						OR = {
							GER = {
								OR = {
									exists = no
									is_faction_leader = no
									has_war_with = ROOT
								}
							}
							RUS = { has_country_flag = RUS_iranian_aid_sent } # Disable if RUS has sent aid to PER during LC
						}
					}
					set_country_flag = PER_align_with_GER
				}
				## Align with RUS
				35 = {
					modifier = {
						factor = 0
						OR = {
							has_country_flag = PER_RUS_refused_alliance_offer
							RUS = {
								OR = {
									exists = no
									is_faction_leader = no
									has_socialist_government = yes
									has_war_with = ROOT
								}
							}
						}
					}
					set_country_flag = PER_align_with_RUS
				}
				## Do not join a major faction through focus
				30 = {
					set_country_flag = PER_neutrality
				}
			}
		}
	}
}

PER_puppet_setup = {
	if = {
		limit = { has_socialist_government = no }
		remove_ideas = {
			PER_beacon_mideast_socialism
			PER_evolution_idea
		}
	}
	if = {
		limit = { has_elected_government = no }
		remove_ideas = PER_shining_democracy
	}
	if = {
		limit = { has_authoritarian_government = no }
		remove_ideas = PER_legacy_of_agha_khan
	}
}

PER_puppet_KUR = {
	KUR = {
		if = {
			limit = { has_war_with = OTT }
			get_current_government_type = yes
			PER = {
				puppet = {
					target = PREV
					end_wars = no
				}
			}
			restore_previous_government_type = yes
		}
	}
}

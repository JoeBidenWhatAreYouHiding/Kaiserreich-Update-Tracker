SHD_zongchang_clique_flees = {
	if = {
		limit = { has_character = SHD_zhang_zongchang }
		effect_tooltip = {
			retire_character = SHD_zhang_zongchang
			retire_character = SHD_li_zaolin
			retire_character = SHD_chu_yupu
			retire_character = SHD_lin_jianzhang
			retire_character = SHD_sun_dianying
			retire_character = SHD_zhang_jingyao
			retire_character = SHD_qu_tongfeng
			retire_character = SHD_boris_annenkov
		}
		hidden_effect = {
			SHD_zhang_zongchang = {
				demote_leader = yes
				remove_all_country_leader_roles = yes
			}
			every_character = {
				limit = { SHD_is_zongchang_loyalist = yes }
				remove_all_country_leader_roles = yes
				remove_second_in_command_role = yes
				retire = yes
			}
			if = {
				limit = { SHD_is_led_by_yingguang = yes }
				FNG = { country_event = { id = shandong_events.501 days = 5 } }
			}
			else = {
				FNG = { country_event = { id = shandong_events.502 days = 5 } }
			}
		}
	}
}

SHD_spawn_cavalry_units = {
	custom_override_tooltip = {
		tooltip = {
			localization_key = tooltip_create_division_template
			NAME = "Hua Bei Qibing"
			LINE_1 = { localization_key = line_battalion_tt NAME = cavalry ICON = GFX_unit_cavalry_icon_small COUNT = 6 }
			SUPPORT_1 = { localization_key = support_battalion_tt NAME = artillery ICON = GFX_unit_artillery_icon_small }
		}
		if = {
			limit = { has_template = "Hua Bei Qibing" }
			delete_unit_template_and_units = { division_template = "Hua Bei Qibing" disband = yes } #no cheating
		}
		division_template = {
			name = "Hua Bei Qibing"
			division_names_group = CHYN_CAV_01
			regiments = {
				cavalry = { x = 0 y = 0 }
				cavalry = { x = 0 y = 1 }
				cavalry = { x = 0 y = 2 }
				cavalry = { x = 1 y = 0 }
				cavalry = { x = 1 y = 1 }
				cavalry = { x = 1 y = 2 }
			}
			support = {
				artillery = { x = 0 y = 0 }
			}
		}
	}
	random_owned_controlled_state = {
		prioritize = { 597 }
		limit = { valid_state_for_spawning_friendly_unit = yes }
		custom_override_tooltip = {
			tooltip = {
				localization_key = tooltip_spawn_units
				COUNT = 3
				TYPE = "Hua Bei Qibing"
			}
			create_unit = {
				division = "division_template = \"Hua Bei Qibing\" start_experience_factor = 1.0"
				owner = ROOT
				count = 3
			}
		}
	}
}

SHD_add_tank_template = {
	if = {
		limit = { has_dlc_nsb = no }
		if = {
			limit = { NOT = { has_tech = gwtank } }
			set_technology = { gwtank = 1 }
		}
	}
	else = {
		if = {
			limit = { NOT = { has_tech = gwtank_chassis } }
			set_technology = { gwtank_chassis = 1 }
		}
	}
	custom_override_tooltip = {
		tooltip = {
			localization_key = tooltip_create_division_template
			NAME = "Si Tu Beike Jiache"
			LINE_1 = { localization_key = line_battalion_tt NAME = infantry ICON = GFX_unit_infantry_icon_small COUNT = 2 }
			LINE_2 = { localization_key = line_battalion_tt NAME = light_armor ICON = GFX_unit_light_armor_icon_small COUNT = 3 }
		}
		if = {
			limit = { has_template = "Si Tu Beike Jiache" }
			delete_unit_template_and_units = { division_template = "Si Tu Beike Jiache" disband = yes } #no cheating
		}
		division_template = {
			name = "Si Tu Beike Jiache"
			division_names_group = CHYN_ARM_01
			regiments = {
				infantry = { x = 0 y = 0 }
				infantry = { x = 0 y = 1 }
				light_armor = { x = 1 y = 0 }
				light_armor = { x = 1 y = 1 }
				light_armor = { x = 1 y = 2 }
			}
		}
	}
	add_tech_bonus = {
		name = SHD_novel_military_projects
		bonus = 0.75
		uses = 2
		category = armor
	}
}

SHD_add_bicycle_template = {
	enable_tech_bicycle_battalion = yes
	if = {
		limit = { NOT = { has_tech = tech_support } }
		set_technology = { tech_support = 1 }
	}
	custom_override_tooltip = {
		tooltip = {
			localization_key = tooltip_create_division_template
			NAME = "Fei Ge Juntuan Beifa"
			LINE_1 = { localization_key = line_battalion_tt NAME = bicycle_battalion ICON = GFX_unit_bicycle_battalion_icon_small COUNT = 6 }
		}
		if = {
			limit = { has_template = "Fei Ge Juntuan Beifa" }
			delete_unit_template_and_units = { division_template = "Fei Ge Juntuan Beifa" disband = yes } #no cheating
		}
		division_template = {
			name = "Fei Ge Juntuan Beifa"
			division_names_group = CHYN_INF_01
			regiments = {
				bicycle_battalion = { x = 0 y = 0 }
				bicycle_battalion = { x = 0 y = 1 }
				bicycle_battalion = { x = 0 y = 2 }
				bicycle_battalion = { x = 1 y = 0 }
				bicycle_battalion = { x = 1 y = 1 }
				bicycle_battalion = { x = 1 y = 2 }
			}
		}
	}
	add_tech_bonus = {
		name = SHD_novel_military_projects
		bonus = 0.75
		uses = 2
		category = support_tech
	}
}

SHD_add_mountaineer_template = {
	if = {
		limit = { NOT = { has_tech = tech_mountaineers } }
		set_technology = { tech_mountaineers = 1 }
	}
	if = {
		limit = { NOT = { has_tech = tech_support } }
		set_technology = { tech_support = 1 }
	}
	if = {
		limit = { NOT = { has_tech = tech_recon } }
		set_technology = { tech_recon = 1 }
	}
	custom_override_tooltip = {
		tooltip = {
			localization_key = tooltip_create_division_template
			NAME = "Dong Tian Juntuan Beifa"
			LINE_1 = { localization_key = line_battalion_tt NAME = mountaineers ICON = GFX_unit_mountaineers_icon_small COUNT = 6 }
		}
		if = {
			limit = { has_template = "Dong Tian Juntuan Beifa" }
			delete_unit_template_and_units = { division_template = "Dong Tian Juntuan Beifa" disband = yes } #no cheating
		}
		division_template = {
			name = "Dong Tian Juntuan Beifa"
			division_names_group = CHYN_INF_01
			regiments = {
				mountaineers = { x = 0 y = 0 }
				mountaineers = { x = 0 y = 1 }
				mountaineers = { x = 0 y = 2 }
				mountaineers = { x = 1 y = 0 }
				mountaineers = { x = 1 y = 1 }
				mountaineers = { x = 1 y = 2 }
			}
			priority = 2
		}
	}
	add_tech_bonus = {
		name = SHD_novel_military_projects
		bonus = 0.75
		uses = 2
		category = recon_tech
		category = mountaineers_tech
	}
}

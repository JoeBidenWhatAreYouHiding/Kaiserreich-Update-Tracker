###########################
# Hejaz - By TheFallenHero / DarkyDu
###########################

add_namespace = hejaz_events

#######################
# GREAT HEJAZI REVOLT #
#######################

country_event = {	#Hejaz joins the revolt
	id = hejaz_events.1
	immediate = {
		log = "KR_Event_Logging;Hejaz REVOLTS AGAINST OTT"
	}
	title = hejaz_events.1.t
	desc = hejaz_events.1.d

	trigger = {
		has_war_with = EGY
		754 = { is_owned_and_controlled_by = ROOT } #Mecca
	}

	fire_only_once = yes

	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			679 = {
				teleport_armies = { limit = { is_ally_with = ROOT } }
				transfer_state_to = HEJ
			}
			HEJ = {
				HEJ_uprising_setup = yes
				add_ideas = {
					limited_exports
					volunteer_only
				}
			}
			news_event = { id = levant_crisis_news.4 days = 1 }
			if = {
				limit = {
					var:292.owner = {
						OR = {
							tag = SAU
							tag = JBS
						}
						is_subject = no
						NOT = { is_in_faction_with = OTT }
					}
				}
				var:292.owner = {
					country_event = { id = hejaz_events.3 days = 2 }
				}
			}
			else = {
				EGY = { add_to_faction = HEJ }
			}
		}
	}

	#option = {
	#	name = hejaz_events.1.a
	#	HEJ = {
	#		change_tag_from = OTT
	#	}
	#}
	option = {
		log = "[GetLogInfo]: event hejaz_events.1 option hejaz_events.1.b"
		name = hejaz_events.1.b
		add_political_power = -20
	}
}

country_event = {	#Medina joins the revolt
	id = hejaz_events.2
	title = hejaz_events.2.t
	desc = hejaz_events.2.d

	trigger = {
		has_war_with = EGY
		has_war_with = HEJ
		754 = { is_owned_and_controlled_by = ROOT } #Medina
	}

	fire_only_once = yes

	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			754 = {
				teleport_armies = { limit = { is_ally_with = ROOT } }
				transfer_state_to = HEJ
			}
		}
	}

	option = {
		log = "[GetLogInfo]: event hejaz_events.2 option hejaz_events.2.a"
		name = hejaz_events.2.a
		add_political_power = -20
	}
}

country_event = {	#The Hashemite Revolt
	id = hejaz_events.3
	title = hejaz_events.3.t
	desc = hejaz_events.3.d

	is_triggered_only = yes

	option = {
		log = "[GetLogInfo]: event hejaz_events.3 option hejaz_events.3.a"
		name = hejaz_events.3.a
		ai_chance = {
			base = 30
			modifier = {
				factor = 0
				tag = JBS
				NOT = { has_game_rule = { rule = JBS_unification option = DEFAULT } }
			}
		}
		OTT = { country_event = hejaz_events.4 }
		EGY = { add_to_faction = HEJ }
	}
	option = {
		log = "[GetLogInfo]: event hejaz_events.3 option hejaz_events.3.b"
		name = hejaz_events.3.b
		ai_chance = {
			base = 70
			modifier = {
				factor = 0
				has_war_with = IKH
				OR = {
					tag = SAU
					AND = {
						tag = JBS
						has_game_rule = { rule = JBS_unification option = DEFAULT }
					}
				}
			}
		}
		if = {
			limit = {
				NOT = { has_war_with = OTT }
			}
			declare_war_on = {
				target = OTT
				type = annex_everything
			}
		}
		if = {
			limit = { is_in_faction_with = EGY }
			EGY = { remove_from_faction = PREV }
		}
		declare_war_on = {
			target = HEJ
			type = annex_everything
		}
		HEJ = {
			country_event = hejaz_events.6
		}
	}
}

country_event = {	#Peace Offer from the Peninsula
	id = hejaz_events.4
	title = hejaz_events.4.t
	desc = hejaz_events.4.d

	is_triggered_only = yes

	option = {
		log = "[GetLogInfo]: event hejaz_events.4 option hejaz_events.4.a"
		name = hejaz_events.4.a
		ai_chance = { base = 80 }
		every_owned_state = {
			limit = {
				OR = {
					is_core_of = FROM
					is_claimed_by = FROM
				}
			}
			if = {
				limit = { is_core_of = ROOT }
				remove_core_of = ROOT
			}
			if = {
				limit = { is_claimed_by = ROOT }
				remove_claim_by = ROOT
			}
			transfer_state_to = FROM
		}
		FROM = {
			leave_faction = yes
			white_peace_with_ROOT = yes
		}
	}
	option = {
		log = "[GetLogInfo]: event hejaz_events.4 option hejaz_events.4.b"
		name = hejaz_events.4.b
		ai_chance = { base = 20 }
		FROM = {
			country_event = { id = hejaz_events.5 days = 1 }
		}
	}
}

country_event = {	#Ottomans refuse our offer
	id = hejaz_events.5
	title = hejaz_events.5.t
	desc = hejaz_events.5.d

	is_triggered_only = yes

	option = {
		log = "[GetLogInfo]: event hejaz_events.5 option hejaz_events.5.a"
		name = hejaz_events.5.a
		add_war_support = -0.2
	}
}

country_event = {	#The Invasion of Hejaz
	id = hejaz_events.6
	title = hejaz_events.6.t
	desc = hejaz_events.6.d

	is_triggered_only = yes

	fire_only_once = yes

	option = {
		log = "[GetLogInfo]: event hejaz_events.6 option hejaz_events.6.a"
		name = hejaz_events.6.a
		FROM = { activate_mission = HEJ_invasion_of_hejaz }
		activate_mission = HEJ_resist_arab_invasion
		EGY = {
			country_event = { id = hejaz_events.7 days = 1 }
		}
	}
}

country_event = {	#The Invasion of Hejaz
	id = hejaz_events.7
	title = hejaz_events.7.t
	desc = hejaz_events.7.d

	is_triggered_only = yes

	fire_only_once = yes

	option = {
		log = "[GetLogInfo]: event hejaz_events.7 option hejaz_events.7.a"
		name = hejaz_events.7.a
		ai_chance = { base = 100 }
	}
	option = {
		log = "[GetLogInfo]: event hejaz_events.7 option hejaz_events.7.b"
		name = hejaz_events.7.b
		ai_chance = { base = 0 }
		add_to_faction = HEJ
	}
}

country_event = {	#Fall of Mecca
	id = hejaz_events.8
	title = hejaz_events.8.t
	desc = hejaz_events.8.d

	is_triggered_only = yes

	fire_only_once = yes

	option = {
		log = "[GetLogInfo]: event hejaz_events.8 option hejaz_events.8.a"
		name = hejaz_events.8.a
		random_country = {
			limit = {
				owns_state = 915
				has_war_with = OTT
			}
			country_event = hejaz_events.9
		}
	}
}

country_event = {	#Egypt recognises our territory
	id = hejaz_events.9
	title = hejaz_events.9.t
	desc = hejaz_events.9.d

	is_triggered_only = yes

	fire_only_once = yes

	option = {
		log = "[GetLogInfo]: event hejaz_events.9 option hejaz_events.9.a"
		name = hejaz_events.9.a
		ai_chance = { base = 100 }
		EGY = {
			add_to_faction = ROOT
		}
		add_war_support = -0.10
	}
	option = {
		log = "[GetLogInfo]: event hejaz_events.9 option hejaz_events.9.b"
		name = hejaz_events.9.b
		ai_chance = { base = 0 }
		EGY = {
			country_event = { id = hejaz_events.10 days = 2 }
		}
	}
}

country_event = {	#Arabia abandons the cause
	id = hejaz_events.10
	title = hejaz_events.10.t
	desc = hejaz_events.10.d

	is_triggered_only = yes

	fire_only_once = yes

	option = {
		log = "[GetLogInfo]: event hejaz_events.10 option hejaz_events.10.a"
		name = hejaz_events.10.a
		add_political_power = -30
	}
}

country_event = {	#Mecca holds strong
	id = hejaz_events.11
	title = hejaz_events.11.t
	desc = hejaz_events.11.d

	is_triggered_only = yes

	fire_only_once = yes

	option = {
		log = "[GetLogInfo]: event hejaz_events.11 option hejaz_events.11.a"
		name = hejaz_events.11.a
		add_to_faction = FROM
		every_other_country = {
			limit = {
				is_arabian_tag = yes
				has_war_with = FROM
			}
			country_event = { id = hejaz_events.12 hours = 8 }
		}
	}
}

country_event = {	#Egypt demands an end to hostilities
	id = hejaz_events.12
	title = hejaz_events.12.t
	desc = hejaz_events.12.d

	is_triggered_only = yes
	fire_only_once = yes

	option = {
		log = "[GetLogInfo]: event hejaz_events.12 option hejaz_events.12.a"
		name = hejaz_events.12.a
		ai_chance = { base = 50 }
	}

	option = {
		log = "[GetLogInfo]: event hejaz_events.12 option hejaz_events.12.b"
		name = hejaz_events.12.b
		ai_chance = { base = 50 }
		FROM = {
			white_peace_with_ROOT = yes
			add_to_faction = ROOT
		}
	}
}

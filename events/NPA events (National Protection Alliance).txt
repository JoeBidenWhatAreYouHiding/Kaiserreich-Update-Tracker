#########################
# Southern China Events #
#########################
#	By Vidyaorsz√°g		#
#########################

add_namespace = national_protection_alliance_events

### National Protection Alliance
country_event = {#Formation of the NPA
	id = national_protection_alliance_events.1
	title = national_protection_alliance_events.1.t
	desc = national_protection_alliance_events.1.d
	picture = GFX_report_event_CHI_official_announcement

	is_triggered_only = yes

	option = {
		log = "[GetLogInfo]: event national_protection_alliance_events.1 option national_protection_alliance_events.1.a"
		name = national_protection_alliance_events.1.a
		if = {
			limit = {
				has_country_leader = { character = GXC_ma_ji }
			}
			GXC_ma_ji = {
				swap_country_leader_traits = {
					remove = CHN_southern_zhili_aligned
					add = CHN_non_aligned
					ideology = paternal_autocrat_subtype
				}
			}
		}
		else_if = {
			limit = {
				has_country_leader = { character = GXC_chen_lianbo }
			}
			GXC_chen_lianbo = {
				swap_country_leader_traits = {
					remove = CHN_anguojun_aligned
					add = CHN_non_aligned
					ideology = market_liberal_subtype
				}
			}
		}
		var:country_leader = { china_set_character_alignment_unaligned = yes }
		add_political_power = 75
		save_global_event_target_as = npa_leader
		if = {
			limit = { has_country_leader = { character = GXC_ma_ji } }
			set_cosmetic_tag = national_protection_alliance_guangxi
		}
		else = {
			set_cosmetic_tag = national_protection_alliance
		}
		hidden_effect = {
			set_potential_national_government = yes
		}
		if = {
			limit = {
				NOT = { original_tag = YUN } #Yunnan has an entire foreign policy focus tree
			}
			china_enable_all_demand_submission_decisions = yes
		}
	}
}
country_event = {#x wishes to join the NPA
	id = national_protection_alliance_events.2
	title = national_protection_alliance_events.2.t
	desc = national_protection_alliance_events.2.d
	picture = GFX_report_event_CHI_warlords

	is_triggered_only = yes

	option = {#Yes!
		log = "[GetLogInfo]: event national_protection_alliance_events.2 option national_protection_alliance_events.2.a"
		name = national_protection_alliance_events.2.a
		effect_tooltip = { china_puppet_FROM_effect = yes }
		FROM = { country_event = national_protection_alliance_events.3 }
	}
	option = {#Nah
		log = "[GetLogInfo]: event national_protection_alliance_events.2 option national_protection_alliance_events.2.b"
		name = national_protection_alliance_events.2.b
		ai_chance = { base = 0 }
		FROM = { country_event = national_protection_alliance_events.4 }
	}
}
country_event = {#NPA accepts
	id = national_protection_alliance_events.3
	title = national_protection_alliance_events.3.t
	desc = national_protection_alliance_events.3.d
	picture = GFX_report_event_CHI_warlords

	is_triggered_only = yes

	option = {#Good
		log = "[GetLogInfo]: event national_protection_alliance_events.3 option national_protection_alliance_events.3.a"
		name = national_protection_alliance_events.3.a
		add_political_power = 10
		FROM = { china_puppet_ROOT_effect = yes }
	}
}
country_event = {#NPA refuses
	id = national_protection_alliance_events.4
	title = national_protection_alliance_events.4.t
	desc = national_protection_alliance_events.4.d
	picture = GFX_report_event_CHI_warlord_observer

	is_triggered_only = yes

	option = {#???
		log = "[GetLogInfo]: event national_protection_alliance_events.4 option national_protection_alliance_events.4.a"
		name = national_protection_alliance_events.4.a
		add_political_power = -5
	}
}
country_event = {#x invited to join the NPA
	id = national_protection_alliance_events.5
	title = national_protection_alliance_events.5.t
	desc = national_protection_alliance_events.5.d
	picture = GFX_report_event_CHI_official_announcement

	is_triggered_only = yes

	option = {#Yes!
		log = "[GetLogInfo]: event national_protection_alliance_events.5 option national_protection_alliance_events.5.a"
		name = national_protection_alliance_events.5.a
		ai_chance = {
			modifier = {
				factor = 0
				OR = {
					AND = {
						tag = ANQ
						NOT = { has_game_rule = { rule = ANQ_forpol option = DEFAULT } }
						NOT = { has_game_rule = { rule = ANQ_forpol option = ANQ_FORPOL_NPA } }
					}
					AND = {
						tag = GXC
						NOT = { has_game_rule = { rule = GXC_forpol option = DEFAULT } }
						NOT = { has_game_rule = { rule = GXC_forpol option = GXC_FORPOL_NPA } }
						NOT = { has_game_rule = { rule = GXC_forpol option = GXC_FORPOL_FORM_NPA } }
					}
					AND = {
						tag = SHX
						NOT = { has_game_rule = { rule = SHX_forpol option = DEFAULT } }
						NOT = { has_game_rule = { rule = SHX_forpol option = SHX_FORPOL_NPA } }
					}
					AND = {
						tag = SZC
						NOT = { has_game_rule = { rule = SZC_forpol option = DEFAULT } }
						NOT = { has_game_rule = { rule = SZC_forpol option = SZC_FORPOL_NPA } }
						NOT = { has_game_rule = { rule = SZC_forpol option = SZC_FORPOL_FORM_NPA } }
					}
					AND = {
						tag = YUN
						NOT = { has_game_rule = { rule = YUN_forpol option = DEFAULT } }
						NOT = { has_game_rule = { rule = YUN_forpol option = YUN_FORPOL_NPA } }
						NOT = { has_game_rule = { rule = YUN_forpol option = YUN_FORPOL_FORM_NPA } }
					}
				}
			}
		}
		FROM = {
			effect_tooltip = { china_puppet_ROOT_effect = yes }
			country_event = national_protection_alliance_events.6
		}
	}
	option = {#Nah
		log = "[GetLogInfo]: event national_protection_alliance_events.5 option national_protection_alliance_events.5.b"
		name = national_protection_alliance_events.5.b
		ai_chance = {
			modifier = {
				factor = 0
				OR = {
					AND = {
						tag = ANQ
						NOT = { has_game_rule = { rule = ANQ_forpol option = DEFAULT } }
						NOT = { has_game_rule = { rule = ANQ_forpol option = ANQ_FORPOL_NPA } }
					}
					AND = {
						tag = GXC
						OR = {
							has_game_rule = { rule = GXC_forpol option = GXC_FORPOL_FORM_NPA }
							has_game_rule = { rule = GXC_forpol option = GXC_FORPOL_NPA }
						}
					}
					AND = {
						tag = SHX
						has_game_rule = { rule = SHX_forpol option = SHX_FORPOL_NPA }
					}
					AND = {
						tag = SZC
						OR = {
							has_game_rule = { rule = SZC_forpol option = SZC_FORPOL_FORM_NPA }
							has_game_rule = { rule = SZC_forpol option = SZC_FORPOL_NPA }
						}
					}
					AND = {
						tag = YUN
						OR = {
							has_game_rule = { rule = YUN_forpol option = YUN_FORPOL_FORM_NPA }
							has_game_rule = { rule = YUN_forpol option = YUN_FORPOL_NPA }
						}
					}
				}
			}
		}
		add_political_power = -15
		FROM = { country_event = national_protection_alliance_events.7 }
	}
}
country_event = {#x accepts
	id = national_protection_alliance_events.6
	title = national_protection_alliance_events.6.t
	desc = national_protection_alliance_events.6.d
	picture = GFX_report_event_CHI_warlords

	is_triggered_only = yes

	option = {#Good
		log = "[GetLogInfo]: event national_protection_alliance_events.6 option national_protection_alliance_events.6.a"
		name = national_protection_alliance_events.6.a
		add_political_power = 10
		china_puppet_FROM_effect = yes
	}
}
country_event = {#x refuses
	id = national_protection_alliance_events.7
	title = national_protection_alliance_events.7.t
	desc = national_protection_alliance_events.7.d
	picture = GFX_report_event_CHI_warlord_observer

	is_triggered_only = yes

	option = {#Welp
		log = "[GetLogInfo]: event national_protection_alliance_events.7 option national_protection_alliance_events.7.a"
		name = national_protection_alliance_events.7.a
		add_to_array = { ROOT.china_possible_targets_array = FROM }
		effect_tooltip = { activate_targeted_decision = { target = FROM decision = china_demand_submission } }
	}
}

### NPA Power Struggle (What, you expected a seamless reunification with all these warlords?)
country_event = {#Beijing falls
	id = national_protection_alliance_events.8
	title = national_protection_alliance_events.8.t
	desc = national_protection_alliance_events.8.d
	picture = GFX_report_event_CHI_beijing_beiyang_flag

	fire_only_once = yes
	is_triggered_only = yes

	trigger = {
		is_ally_with = 608.owner
		has_war = no
	}

	option = {#Proclaim a provisional govt
		log = "[GetLogInfo]: event national_protection_alliance_events.8 option national_protection_alliance_events.8.a"
		name = national_protection_alliance_events.8.a
		#annex puppets
		if = {
			limit = { any_subject_country = { china_is_governorate = yes } }
			every_subject_country = {
				limit = { china_is_governorate = yes }
				country_event = { id = national_protection_alliance_events.10 days = 1 }
			}
		}
		else = {
			country_event = { id = national_protection_alliance_events.9 days = 1 }
		}
		hidden_effect = {
			country_event = { id = national_protection_alliance_events.11 days = 2 }
		}
	}
}
country_event = {#NPA secured - ProvGovt formed
	id = national_protection_alliance_events.9
	title = national_protection_alliance_events.9.t
	desc = national_protection_alliance_events.9.d
	picture = GFX_report_event_CHI_new_government

	is_triggered_only = yes
	fire_only_once = yes

	option = {#Long live the Republic!
		log = "[GetLogInfo]: event national_protection_alliance_events.9 option national_protection_alliance_events.9.a"
		name = national_protection_alliance_events.9.a
		add_political_power = 100
		set_global_flag = NPA_secured
		save_global_event_target_as = npa_leader
	}
}
country_event = {#Join ProvGovt?
	id = national_protection_alliance_events.10
	title = national_protection_alliance_events.10.t
	desc = national_protection_alliance_events.10.d
	picture = GFX_report_event_CHI_new_government

	is_triggered_only = yes

	option = {#Accept leadership
		log = "[GetLogInfo]: event national_protection_alliance_events.10 option national_protection_alliance_events.10.a"
		name = national_protection_alliance_events.10.a
		ai_chance = {
			base = 50
			modifier = {
				factor = 2
				FROM = { same_government_type_as_ROOT = yes }
				NOT = { has_government = paternal_autocrat }
			}
		}
	}
	option = {#Start power struggle
		log = "[GetLogInfo]: event national_protection_alliance_events.10 option national_protection_alliance_events.10.b"
		name = national_protection_alliance_events.10.b
		ai_chance = {
			base = 50
			modifier = {
				factor = 0
				FROM = { same_government_type_as_ROOT = yes }
				NOT = { has_government = paternal_autocrat }
			}
		}
		set_global_flag = NPA_revolt
		set_country_flag = NPA_revolt
		FROM = { china_break_puppet_effect = yes }
	}
}
country_event = {#Hidden event: Checks if anyone revolted
	id = national_protection_alliance_events.11
	title = national_protection_alliance_events.11.t
	desc = national_protection_alliance_events.11.d

	is_triggered_only = yes
	fire_only_once = yes
	hidden = yes

	option = {
		log = "[GetLogInfo]: event national_protection_alliance_events.11 option national_protection_alliance_events.11.a"
		name = national_protection_alliance_events.11.a
		if = {
			limit = { has_global_flag = NPA_revolt }
			country_event = national_protection_alliance_events.12
		}
		else = {
			country_event = national_protection_alliance_events.9
		}
	}
}
country_event = {#Civil War begins
	id = national_protection_alliance_events.12
	title = national_protection_alliance_events.12.t
	desc = national_protection_alliance_events.12.d
	picture = GFX_report_event_CHI_warlord_battle

	is_triggered_only = yes
	fire_only_once = yes

	option = {#it's treason then haha look at me making a prequel meme in my code!!!!
		log = "[GetLogInfo]: event national_protection_alliance_events.12 option national_protection_alliance_events.12.a"
		name = national_protection_alliance_events.12.a
		every_subject_country = {
			limit = { china_is_governorate = yes }
			set_country_flag = NPA_revolt
			china_break_puppet_effect = yes
			effect_tooltip = {
				declare_war_on = {
					target = ROOT
					type = annex_everything
				}
			}
		}
		hidden_effect = { country_event = national_protection_alliance_events.13 }
	}
}
country_event = {#Claimants DoW each other
	id = national_protection_alliance_events.13

	is_triggered_only = yes
	fire_only_once = yes
	hidden = yes

	option = {#Hoping this actually works
		log = "[GetLogInfo]: event national_protection_alliance_events.13 option 1"
		set_country_flag = NPA_revolt
		every_country = {
			limit = { has_country_flag = NPA_revolt }
			every_other_country = {
				limit = {
					has_country_flag = NPA_revolt
					can_declare_war_on = PREV
				}
				declare_war_on = {
					target = PREV
					type = annex_everything
				}
			}
		}
	}
}
country_event = {#Claimants crushed
	id = national_protection_alliance_events.14
	title = national_protection_alliance_events.14.t
	desc = national_protection_alliance_events.14.d
	picture = GFX_report_event_CHI_warlord_observer

	fire_only_once = yes
	is_triggered_only = yes

	trigger = {
		has_war = no
	}

	option = {#Long live the Republic!
		log = "[GetLogInfo]: event national_protection_alliance_events.14 option national_protection_alliance_events.14.a"
		name = national_protection_alliance_events.14.a
		add_political_power = 100
		set_global_flag = NPA_secured
		save_global_event_target_as = npa_leader
	}
}
###Post-unification
country_event = {#pro-govt party forms for warlord who united china
	id = national_protection_alliance_events.15
	title = national_protection_alliance_events.15.t
	desc = national_protection_alliance_events.15.d
	picture = GFX_report_event_CHI_new_government

	fire_only_once = yes
	is_triggered_only = yes

	option = {
		log = "[GetLogInfo]: event national_protection_alliance_events.15 option national_protection_alliance_events.15.a"
		name = national_protection_alliance_events.15.a
		if = {
			limit = {
				NOT = { has_country_leader = { character = YUN_tang_jiyao } } #Tang Jiyao should keep the authdem PIP
			}
			set_party_name = {
				ideology = authoritarian_democrat
				long_name = CHS_authoritarian_democrat_party_long
				name = CHS_authoritarian_democrat_party
			}
		}
		set_party_name = {
			ideology = paternal_autocrat
			long_name = CHS_authoritarian_democrat_party_long
			name = CHS_authoritarian_democrat_party
		}
		if = {
			limit = {
				has_authdem_or_pataut_government = no
				NOT = { original_tag = SZC }
				NOT = { original_tag = HNN }
			}
			set_party_name = {
				ideology = var:current_party_ideology_group
				long_name = CHS_authoritarian_democrat_party_long
				name = CHS_authoritarian_democrat_party
			}
		}
		set_temp_variable = { coalition_partner_var = token:authoritarian_democrat }
		add_to_coalition = yes
		set_temp_variable = { coalition_partner_var = token:paternal_autocrat }
		add_to_coalition = yes
	}
}
country_event = {#reinstating 1924 constitution
	id = national_protection_alliance_events.16
	title = national_protection_alliance_events.16.t
	desc = national_protection_alliance_events.16.d
	picture = GFX_report_event_CHI_new_government

	fire_only_once = yes
	is_triggered_only = yes

	option = {#"""provisionally"""
		log = "[GetLogInfo]: event national_protection_alliance_events.16 option national_protection_alliance_events.16.a"
		name = national_protection_alliance_events.16.a
		add_political_power = 50
	}
}
country_event = {#National assembly elections
	id = national_protection_alliance_events.17
	title = national_protection_alliance_events.17.t
	desc = national_protection_alliance_events.17.d
	picture = GFX_report_event_CHI_vote

	fire_only_once = yes
	is_triggered_only = yes

	option = {#gee wiz I wonder if there were any shennanigans or tampering here!!!
		log = "[GetLogInfo]: event national_protection_alliance_events.17 option national_protection_alliance_events.17.a"
		name = national_protection_alliance_events.17.a
		add_political_power = 50
		add_stability = 0.10
		set_temp_variable = { ideology_change_var = 0.2 }
		change_ruling_party_popularity = yes
	}
}
country_event = {#FROM refuses
	id = national_protection_alliance_events.21
	title = national_protection_alliance_events.21.t
	desc = national_protection_alliance_events.21.d
	picture = GFX_report_event_CHI_warlord_observer

	is_triggered_only = yes

	option = {#They chose death
		log = "[GetLogInfo]: event national_protection_alliance_events.21 option national_protection_alliance_events.21.a"
		name = national_protection_alliance_events.21.a
		declare_war_on = {
			target = FROM
			type = annex_everything
		}
	}
}

